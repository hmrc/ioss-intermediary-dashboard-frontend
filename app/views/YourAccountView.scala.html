@*
 * Copyright 2026 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import viewmodels.InputWidth._
@import viewmodels.dashboard.DashboardUrlsViewModel

@this(
    layout: templates.Layout,
    govukWarningText: GovukWarningText
)

@(
    businessName: String,
    intermediaryNumber: String,
    numberOfMessages: Int,
    unreadMessage: Boolean,
    numberOfAwaitingClients: Long,
    cancelYourRequestToLeaveUrl: Option[String],
    numberOfSavedUserJourneys: Long,
    urls: DashboardUrlsViewModel,
    canRejoin: Boolean,
    hasOutstandingRetuns: Boolean
)(implicit request: Request[_], messages: Messages)

@layout(pageTitle = titleNoForm(messages("yourAccount.title")),
    showBackLink = false,
    fullWidth = true
) {

    <h1 class="govuk-heading-l">
        @messages("yourAccount.heading")
    </h1>
    <span class="govuk-caption-m">@businessName</span>
    <span class="govuk-caption-m govuk-!-margin-bottom-5">@messages("yourAccount.intermediaryNumber", intermediaryNumber)</span>

    <p class="govuk-body">
        <a class="govuk-link" href="@urls.secureMessagesUrl"
           id="messages">
            @if(unreadMessage && numberOfMessages == 1) {
                @Html(messages("yourAccount.messages.unread.singular", numberOfMessages))
            } else if (unreadMessage && numberOfMessages > 1) {
                @Html(messages("yourAccount.messages.unread.plural", numberOfMessages))
            } else {
                @Html(messages("yourAccount.messages.read"))
            }
        </a>
    </p>

    @{
        if(numberOfAwaitingClients > 0) {
            govukWarningText(WarningText(
                iconFallbackText = Option(messages("site.warning")),
                content = Text(messages("yourAccount.clients.clientAwaitingActivation.warn"))
            ))
        } else None
    }

    <div class="flex-container govuk-grid-row">
        <div class="tile tile-no-border">
            <div id="next-return" class="tile-body">
                <h2 class="govuk-heading-m">@messages("yourAccount.returns.heading")</h2>

                @if(urls.continueSavedReturnUrl.nonEmpty) {
                    <p class="govuk-body">
                        <a class="govuk-link" href="@urls.continueSavedReturnUrl"
                           id="continue-return">
                            @messages("yourAccount.returns.savedReturns.continue")
                        </a>
                    </p>
                }

                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.startClientCurrentReturnsUrl"
                       id="start-a-return">
                        @messages("yourAccount.returns.startReturn")
                    </a>
                </p>

                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.viewClientReturnsListUrl"
                       id="view-return">
                        @messages("yourAccount.returns.previousReturn")
                    </a>
                </p>
            </div>
        </div>

        <div class="tile tile-no-border">
            <div id="payments" class="tile-body">
                <h2 class="govuk-heading-m push--top">@messages("yourAccount.payment.heading")</h2>

                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.makeAPaymentUrl"
                       id="make-a-payment">
                        @messages("yourAccount.payment.makeAPayment")
                    </a>
                </p>
            </div>
        </div>

        <div class="tile tile-no-border">
            <div id="clients" class="tile-body">
                <h2 class="govuk-heading-m push--top">@messages("yourAccount.clients.heading")</h2>

                @if(numberOfSavedUserJourneys >= 1) {
                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.continueSavedRegUrl"
                       id="continue-saved-answers">
                        @messages("yourAccount.clients.continueRegistration")
                    </a>
                </p>
                }

                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.addClientUrl"
                       id="add-client">
                        @messages("yourAccount.clients.addClient")
                    </a>
                </p>

                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.viewClientsListUrl"
                       id="edit-client">
                        @messages("yourAccount.clients.editClient")
                    </a>
                </p>

                @if(numberOfAwaitingClients == 1) {
                    <p class="govuk-body">
                        <a class="govuk-link" href="@urls.pendingClientsUrl"
                           id="pending-client-singular">
                            @messages("yourAccount.clients.pendingClient.singular", numberOfAwaitingClients)
                        </a>
                    </p>
                } else if (numberOfAwaitingClients > 1) {
                    <p class="govuk-body">
                        <a class="govuk-link" href="@urls.pendingClientsUrl"
                           id="pending-client-plural">
                            @messages("yourAccount.clients.pendingClient.plural", numberOfAwaitingClients)
                        </a>
                    </p>
                }

            </div>
        </div>

        <div class="tile tile-no-border">
            <div id="details" class="tile-body">
                <h2 class="govuk-heading-m">@messages("yourAccount.details.heading")</h2>

                <p class="govuk-body">
                    <a class="govuk-link" href="@urls.changeYourRegistrationUrl"
                       id="change-your-registration">
                        @messages("yourAccount.details.changeYourRegistration")
                    </a>
                </p>

                @urls.leaveThisServiceUrl.map { url =>
                    <p class="govuk-body">
                        <a class="govuk-link" href="@url"
                           id="leave-scheme">
                            @messages("yourAccount.details.leaveThisService")
                        </a>
                    </p>
                }

                @cancelYourRequestToLeaveUrl.map { url =>
                    <p class="govuk-body">
                        <a class="govuk-link" href="@url"
                           id="cancel-your-request-to-leave">
                            @messages("yourAccount.details.cancelYourRequestToLeave")
                        </a>
                    </p>
                }

                @if(canRejoin && !hasOutstandingRetuns) {
                    <p class="govuk-body">
                        <a class="govuk-link" href="@urls.rejoinSchemeUrl"
                           id="rejoin-scheme">
                            @messages("yourAccount.details.rejoinScheme")
                        </a>
                    </p>
                }
            </div>
        </div>
    </div>
}
